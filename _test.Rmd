---
title: "test"
output: html_document
---

```{r message = false}
library(haven)
library(readr)
library(tidyverse)

raw_dir <- "./dataset"

read_xpt_clean <- function(fname) {
  read_xpt(file.path(raw_dir, fname)) |>
    clean_names()
}


demo_demographics <- read_xpt_clean("DEMO_L.xpt")

blood_pressure_pulse <- read_xpt_clean("Blood_Pressure_Pulse.xpt")

cvd_chol_hdl   <- read_xpt_clean("CVD_Cholesterol_HDL.xpt")
cvd_chol_ldl   <- read_xpt_clean("CVD_Cholesterol_LDL.xpt")
cvd_chol_total <- read_xpt_clean("CVD_Cholesterol_total.xpt")

diab_ghb_hba1c        <- read_xpt_clean("Diabetes_Glycohemoglobin.xpt")
diab_insulin          <- read_xpt_clean("Diabetes_Insulin.xpt")
diab_fasting_glucose  <- read_xpt_clean("Diabetes_Plasma Fasting Glucose.xpt")
diab_questionnaire    <- read_xpt_clean("Diabetes_Q.xpt")

sleep_disorders <- read_xpt_clean("Sleep_Disorders.xpt")

nut_intake_d1 <- read_xpt_clean("T_Nutrient_Intake_D1.xpt")
nut_intake_d2 <- read_xpt_clean("T_Nutrient_Intake_D2.xpt")


food_codebook      <- read_xpt_clean("FoodCode.xpt")
individual_foods_1 <- read_xpt_clean("Individual_Foods_1.xpt")
individual_foods_2 <- read_xpt_clean("Individual_Foods_2.xpt")


```

```{r}
analytic <- demo_demographics |>
  # pressure and pulse
  left_join(blood_pressure_pulse, by = "seqn") |>
  
  # cholesterol
  left_join(cvd_chol_total, by = "seqn") |>
  left_join(cvd_chol_hdl,   by = "seqn") |>
  left_join(cvd_chol_ldl,   by = "seqn") |>
  
  # diabetes
  left_join(diab_ghb_hba1c,       by = "seqn") |>
  left_join(diab_insulin,         by = "seqn") |>
  left_join(diab_fasting_glucose, by = "seqn") |>
  left_join(diab_questionnaire,   by = "seqn") |>
  
  # sleep
  left_join(sleep_disorders, by = "seqn") |>
  
  # intake
  left_join(nut_intake_d1, by = "seqn") |>
  left_join(nut_intake_d2, by = "seqn")

write_csv(analytic, "analytic.csv") 
```

